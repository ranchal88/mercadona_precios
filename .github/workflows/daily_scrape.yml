name: Daily Mercadona Scrape

# Programar para que el flujo de trabajo se ejecute a las 00:00 UTC todos los días
on:
  schedule:
    - cron: '0 0 * * *'  # Esto significa todos los días a medianoche UTC

jobs:
  scrape:
    runs-on: ubuntu-latest  # Especificamos que el flujo de trabajo se ejecutará en un entorno Linux
    steps:
      # Paso 1: Hacer checkout del código
      - name: Checkout code
        uses: actions/checkout@v2

      # Paso 2: Configurar Python
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'  # Utilizamos la versión más reciente de Python 3

      # Paso 3: Instalar las dependencias necesarias
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # Asegúrate de tener las dependencias en requirements.txt

      # Paso 4: Ejecutar el scraper de Mercadona
      - name: Run scraper script
        run: python scripts/mercadona_ccaa_daily.py  # Asegúrate de que el script está en la carpeta correcta
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Necesario para acceso a GitHub

      # Paso 5: Commit y push de los resultados
      - name: Commit and push results
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@users.noreply.github.com"
          git add data/
          git commit -m "Scrape diario por CCAA"
          git push
